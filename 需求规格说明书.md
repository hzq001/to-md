
# 文件转Markdown工具需求规格说明书

## 1. 软件概述

### 1.1 目标
开发一个基于[Microsoft MarkItDown](https://github.com/microsoft/markitdown)的文件转换工具，能够将各种格式的文件（如PDF、Word、PowerPoint等）批量转换为Markdown格式。特别地，该工具需要支持指定目录后自动遍历所有子目录和文件，进行批量转换。

### 1.2 应用场景
- 文档归档与整理
- 知识库建设
- LLM训练数据准备
- 文档内容分析

## 2. 功能需求

### 2.1 核心功能
1. **批量目录处理**：接收输入目录路径，自动遍历该目录及所有子目录
2. **文件格式识别**：自动识别支持的文件类型
3. **转换为Markdown**：调用MarkItDown库将识别的文件转换为Markdown格式
4. **保留目录结构**：转换后的MD文件保持原有的目录结构
5. **日志记录**：记录转换过程中的成功、失败及警告信息

### 2.2 文件类型支持
支持MarkItDown库支持的所有文件类型，包括但不限于：
- PDF文件
- Microsoft Office文档（Word、PowerPoint、Excel）
- 图片文件（含OCR和EXIF元数据）
- 音频文件（含语音转文字）
- HTML文件
- 文本文件（CSV、JSON、XML）
- ZIP压缩文件
- YouTube链接
- EPUB电子书

### 2.3 配置选项
1. **输入输出路径配置**：指定源目录和目标目录
2. **文件类型过滤**：可选择性地指定需要转换的文件类型
3. **插件支持**：能够启用/禁用MarkItDown的插件
4. **高级选项**：支持MarkItDown的高级功能（如Azure文档智能服务）
5. **并行处理**：可配置并行转换的线程数量

## 3. 非功能需求

### 3.1 性能要求
1. 能够处理大型目录结构，包含数千个文件
2. 支持多线程并行处理，提高转换效率
3. 内存占用合理，不因目录文件数量过多导致内存溢出

### 3.2 可靠性要求
1. 单个文件转换失败不应影响整体转换过程
2. 具备断点续传功能，可从中断处继续转换
3. 完整的错误处理机制

### 3.3 可扩展性
1. 模块化设计，便于扩展新的文件类型支持
2. 支持自定义转换规则和后处理

## 4. 技术架构

### 4.1 系统组件
1. **命令行界面**：用于接收用户参数和显示转换进度
2. **目录遍历模块**：负责遍历目录结构并收集文件信息
3. **文件转换模块**：调用MarkItDown API进行文件转换
4. **配置管理模块**：处理用户配置和默认设置
5. **日志管理模块**：记录转换过程和结果

### 4.2 技术依赖
1. Python 3.8或更高版本
2. MarkItDown库及其依赖
3. 相关文件格式转换所需的可选依赖

## 5. 界面设计

### 5.1 命令行界面
```
to-md [选项] <源目录> [目标目录]

选项:
  -r, --recursive          递归处理子目录（默认启用）
  -f, --file-types LIST    指定要处理的文件类型列表（如pdf,docx,pptx）
  -p, --use-plugins        启用MarkItDown插件
  -t, --threads NUM        并行处理的线程数（默认: 4）
  -v, --verbose            显示详细日志
  --docintel-endpoint URL  Azure文档智能服务端点
  --dry-run                模拟运行，不实际转换文件
  --help                   显示帮助信息
```

### 5.2 日志输出
- 转换开始和结束时的摘要信息
- 每个文件的转换状态和结果
- 错误和警告信息
- 统计数据（成功/失败/跳过的文件数）

## 6. 实现细节

### 6.1 文件处理流程
1. 验证输入目录和输出目录
2. 遍历源目录收集符合条件的文件
3. 创建输出目录结构
4. 分批调用MarkItDown库进行转换
5. 保存转换结果
6. 生成转换报告

### 6.2 并行处理策略
- 使用线程池或进程池实现并行处理
- 文件级别的并行，每个文件单独处理
- 设置合理的超时机制

### 6.3 错误处理
- 捕获并记录转换过程中的异常
- 对于不支持的文件类型给出明确提示
- 提供转换失败文件的列表和原因

## 7. 测试要求

### 7.1 单元测试
- 目录遍历功能测试
- 各文件类型转换测试
- 配置管理测试

### 7.2 集成测试
- 完整工作流程测试
- 大目录处理性能测试
- 异常情况处理测试

### 7.3 测试数据
包含各类文件类型的测试目录结构

## 8. 交付物

1. Python源代码
2. 安装和使用文档
3. 示例和教程
4. 测试报告
5. 可执行安装包（可选）

## 9. 项目计划与里程碑

1. 需求分析与设计（1周）
2. 核心功能开发（2周）
3. 测试与优化（1周）
4. 文档编写与发布（1周）

## 10. 附录

### 10.1 术语表
- MarkItDown: Microsoft开发的文件转Markdown工具
- Markdown: 轻量级标记语言，设计用于易读易写的纯文本格式

### 10.2 参考资料
- [MarkItDown GitHub仓库](https://github.com/microsoft/markitdown)
- Markdown语法规范
